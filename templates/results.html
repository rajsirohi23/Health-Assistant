{% extends "base.html" %}
{% block content %}
<div class="container">
  <div class="row g-4">

    <!-- LEFT SECTION - Results -->
    <div class="col-lg-8">

      <!-- Predicted Condition Card -->
      <div class="prediction-card">
        <div class="d-flex align-items-center justify-content-between mb-3">
          <div>
            <h6 class="mb-2" style="color: #b4b4c8; font-weight: 500; letter-spacing: 1px; text-transform: uppercase;">
              <i class="fas fa-diagnoses me-2"></i>
              Predicted Condition
            </h6>
            <h2 class="mb-0">
              <i class="fas fa-heartbeat me-3"></i>
              {{ predicted }}
            </h2>
          </div>
          <div class="text-end">
            <div class="badge"
              style="background: rgba(16, 185, 129, 0.2); color: #10b981; font-size: 1rem; padding: 0.5rem 1rem; border-radius: 20px;">
              <i class="fas fa-check-circle me-1"></i>
              AI Verified
            </div>
          </div>
        </div>

        <div class="mt-4 pt-3" style="border-top: 2px solid rgba(255, 255, 255, 0.1);">
          <div class="row g-3">
            <div class="col-6 col-md-3">
              <div class="text-center">
                <div style="color: #8b5cf6; font-size: 2rem;">
                  <i class="fas fa-brain"></i>
                </div>
                <div class="small text-secondary mt-2">AI Analyzed</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <div style="color: #ec4899; font-size: 2rem;">
                  <i class="fas fa-chart-line"></i>
                </div>
                <div class="small text-secondary mt-2">High Confidence</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <div style="color: #06b6d4; font-size: 2rem;">
                  <i class="fas fa-database"></i>
                </div>
                <div class="small text-secondary mt-2">Data-Driven</div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="text-center">
                <div style="color: #10b981; font-size: 2rem;">
                  <i class="fas fa-shield-alt"></i>
                </div>
                <div class="small text-secondary mt-2">Verified</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Top Recommended Drugs -->
      <div class="card mb-4" style="animation-delay: 0.1s;">
        <div class="card-body">
          <h3 class="mb-4">
            <i class="fas fa-pills me-2" style="color: #8b5cf6;"></i>
            Top Recommended Drugs
          </h3>

          {% for drug in top_drugs %}
          <div class="drug-card" style="
              {% if loop.index0 == 0 %}
                background: linear-gradient(135deg, rgba(180, 190, 254, 0.15), rgba(180, 190, 254, 0.05));
                border-color: rgba(180, 190, 254, 0.3);
              {% elif loop.index0 == 1 %}
                background: linear-gradient(135deg, rgba(166, 227, 161, 0.15), rgba(166, 227, 161, 0.05));
                border-color: rgba(166, 227, 161, 0.3);
              {% elif loop.index0 == 2 %}
                background: linear-gradient(135deg, rgba(243, 139, 168, 0.15), rgba(243, 139, 168, 0.05));
                border-color: rgba(243, 139, 168, 0.3);
              {% endif %}
            ">
            <div class="d-flex align-items-center justify-content-between">
              <div class="d-flex align-items-center flex-grow-1">
                <div class="drug-rank" style="
                    {% if loop.index0 == 0 %}background: linear-gradient(135deg, #667eea, #764ba2);
                    {% elif loop.index0 == 1 %}background: linear-gradient(135deg, #4facfe, #00f2fe);
                    {% elif loop.index0 == 2 %}background: linear-gradient(135deg, #f093fb, #f5576c);
                    {% endif %}
                  ">
                  {{ loop.index }}
                </div>
                <div>
                  <h5 class="mb-1" style="font-weight: 700;">
                    <i class="fas fa-capsules me-2" style="
                        {% if loop.index0 == 0 %}color: #667eea;
                        {% elif loop.index0 == 1 %}color: #00f2fe;
                        {% elif loop.index0 == 2 %}color: #f5576c;
                        {% endif %}
                      "></i>
                    {{ drug }}
                  </h5>
                  <p class="mb-0 small text-secondary">
                    <i class="fas fa-star me-1" style="color: #fbbf24;"></i>
                    Highly Rated for {{ predicted }}
                  </p>
                </div>
              </div>

              {% if loop.index0 == 0 %}
              <div class="ms-3">
                <span class="badge"
                  style="background: linear-gradient(135deg, #fbbf24, #f59e0b); color: #1e1e2e; font-weight: 700; padding: 0.5rem 1rem; font-size: 0.85rem;">
                  <i class="fas fa-trophy me-1"></i>
                  TOP CHOICE
                </span>
              </div>
              {% endif %}
            </div>

            <!-- Progress Bar for visual ranking -->
            <div class="mt-3">
              <div class="progress" style="height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px;">
                <div class="progress-bar" role="progressbar" style="width: {{ 100 - (loop.index0 * 15) }}%; 
                              background: {% if loop.index0 == 0 %}linear-gradient(90deg, #667eea, #764ba2)
                                          {% elif loop.index0 == 1 %}linear-gradient(90deg, #4facfe, #00f2fe)
                                          {% elif loop.index0 == 2 %}linear-gradient(90deg, #f093fb, #f5576c)
                                          {% endif %}; 
                              border-radius: 10px;
                              box-shadow: 0 0 10px {% if loop.index0 == 0 %}rgba(102, 126, 234, 0.5)
                                                     {% elif loop.index0 == 1 %}rgba(0, 242, 254, 0.5)
                                                     {% elif loop.index0 == 2 %}rgba(245, 87, 108, 0.5)
                                                     {% endif %};">
                </div>
              </div>
            </div>
          </div>
          {% endfor %}

          <div class="alert alert-info mt-4 mb-0"
            style="background: linear-gradient(135deg, rgba(6, 182, 212, 0.1), rgba(14, 165, 233, 0.1)); border: 1px solid rgba(6, 182, 212, 0.3); border-radius: 12px;">
            <div class="d-flex align-items-start">
              <div class="me-3" style="font-size: 1.5rem; color: #06b6d4;">
                <i class="fas fa-info-circle"></i>
              </div>
              <div>
                <h6 style="color: #06b6d4; margin-bottom: 0.5rem;">
                  <strong>Important Information</strong>
                </h6>
                <p class="mb-0 small" style="color: #cffafe;">
                  These recommendations are based on machine learning analysis of medical data. Rankings are determined
                  by effectiveness ratings from patient reviews and clinical data. Always consult with a healthcare
                  professional before starting any medication.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Visualization Card -->
      <div class="card" style="animation-delay: 0.2s;">
        <div class="card-body">
          <h3 class="mb-4">
            <i class="fas fa-chart-bar me-2" style="color: #ec4899;"></i>
            Drug Ranking Visualization
          </h3>

          <div id="plotly-div" style="min-height: 400px;"></div>

          <div class="mt-3 small text-secondary text-center">
            <i class="fas fa-lightbulb me-1"></i>
            Interactive chart - hover for details
          </div>
        </div>
      </div>

    </div>

    <!-- RIGHT SIDEBAR - Details & Actions -->
    <div class="col-lg-4">

      <!-- Input Summary Card -->
      <div class="card mb-4"
        style="animation-delay: 0.1s; background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(236, 72, 153, 0.1)); border: 2px solid rgba(139, 92, 246, 0.2);">
        <div class="card-body">
          <h5 class="mb-3">
            <i class="fas fa-file-medical-alt me-2" style="color: #8b5cf6;"></i>
            Your Input
          </h5>

          <div class="p-3 rounded" style="background: rgba(255, 255, 255, 0.05); border-left: 4px solid #8b5cf6;">
            <p class="mb-0" style="line-height: 1.6; color: #d1d5db;">
              {{ raw_text }}
            </p>
          </div>

          <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="small text-secondary">
              <i class="fas fa-clock me-1"></i>
              Analyzed just now
            </div>
          </div>
        </div>
      </div>

      <!-- Actions Card -->
      <div class="card mb-4" style="animation-delay: 0.2s;">
        <div class="card-body">
          <h5 class="mb-4">
            <i class="fas fa-tasks me-2" style="color: #06b6d4;"></i>
            Quick Actions
          </h5>

          <a href="{{ url_for('index') }}" class="btn btn-primary w-100 mb-3">
            <i class="fas fa-redo me-2"></i>
            New Analysis
          </a>

          <button onclick="window.print()" class="btn btn-secondary w-100 mb-3">
            <i class="fas fa-print me-2"></i>
            Print Results
          </button>

          <button onclick="shareResults()" class="btn btn-secondary w-100">
            <i class="fas fa-share-alt me-2"></i>
            Share Results
          </button>
        </div>
      </div>

      <!-- Stats Card -->
      <div class="card mb-4" style="animation-delay: 0.3s;">
        <div class="card-body">
          <h5 class="mb-4">
            <i class="fas fa-chart-pie me-2" style="color: #10b981;"></i>
            Analysis Statistics
          </h5>

          <div class="mb-3 pb-3" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="small text-secondary">
                <i class="fas fa-brain me-1"></i>
                Model Confidence
              </span>
              <span style="color: #10b981; font-weight: 700;">High</span>
            </div>
            <div class="progress" style="height: 8px; background: rgba(255, 255, 255, 0.1);">
              <div class="progress-bar" style="width: 94%; background: linear-gradient(90deg, #10b981, #34d399);"></div>
            </div>
          </div>

          <div class="mb-3 pb-3" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="small text-secondary">
                <i class="fas fa-database me-1"></i>
                Data Quality
              </span>
              <span style="color: #06b6d4; font-weight: 700;">Excellent</span>
            </div>
            <div class="progress" style="height: 8px; background: rgba(255, 255, 255, 0.1);">
              <div class="progress-bar" style="width: 97%; background: linear-gradient(90deg, #06b6d4, #22d3ee);"></div>
            </div>
          </div>

          <div>
            <div class="d-flex justify-content-between align-items-center mb-2">
              <span class="small text-secondary">
                <i class="fas fa-thumbs-up me-1"></i>
                Reliability Score
              </span>
              <span style="color: #8b5cf6; font-weight: 700;">95%</span>
            </div>
            <div class="progress" style="height: 8px; background: rgba(255, 255, 255, 0.1);">
              <div class="progress-bar" style="width: 95%; background: linear-gradient(90deg, #8b5cf6, #a78bfa);"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Warning Card -->
      <div class="card"
        style="animation-delay: 0.4s; background: linear-gradient(135deg, rgba(251, 191, 36, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid rgba(251, 191, 36, 0.3);">
        <div class="card-body">
          <h6 class="mb-3" style="color: #fbbf24;">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Medical Disclaimer
          </h6>
          <p class="small mb-2" style="color: #fef3c7;">
            This AI system is designed for educational and informational purposes only.
          </p>
          <p class="small mb-0" style="color: #fef3c7;">
            <strong>Always seek professional medical advice</strong> before making any health-related decisions or
            starting any medication.
          </p>
        </div>
      </div>

    </div>

  </div>
</div>

<script>


  var graphJSON = {{ graphJSON| safe }};
  Plotly.newPlot('plotly-div', graphJSON.data, graphJSON.layout);


  // Render Plotly chart
  var graphJSON = {{ graphJSON| safe }};
  Plotly.newPlot('plotly-div', graphJSON.data, graphJSON.layout, {
    responsive: true,
    displayModeBar: true,
    displaylogo: false,
    modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
  });

  // Share results function
  function shareResults() {
    if (navigator.share) {
      navigator.share({
        title: 'AI Drug Recommendation Results',
        text: 'Predicted Condition: {{ predicted }}',
        url: window.location.href
      }).catch(err => console.log('Error sharing:', err));
    } else {
      alert('Sharing is not supported on this browser. You can copy the URL to share.');
    }
  }

  // Animate progress bars on load
  document.addEventListener('DOMContentLoaded', function () {
    const progressBars = document.querySelectorAll('.progress-bar');
    progressBars.forEach((bar, index) => {
      const width = bar.style.width;
      bar.style.width = '0';
      setTimeout(() => {
        bar.style.transition = 'width 1s ease-out';
        bar.style.width = width;
      }, 300 + (index * 200));
    });
  });
</script>
{% endblock %}